const t=(t=null,e=new WeakMap)=>n({val:t,old:null,trans:new Set,changed:!1,isNode:!0,info:e}),n=t=>new Proxy(t,{set:r,get:e}),e=(t,n)=>"target"==n?t:t[n],r=(t,n,e)=>"val"==n&&(t.changed||((t,n)=>{let e=[],r=[];return function t(n,o){var a;if(null==n&&null==o)return!0;if(null==n&&null==o)return!0;if(isNaN(n)&&isNaN(o)&&"number"==typeof n&&"number"==typeof o)return!0;if(n===o)return!0;if("function"==typeof n&&"function"==typeof o||n instanceof Date&&o instanceof Date||n instanceof RegExp&&o instanceof RegExp||n instanceof String&&o instanceof String||n instanceof Number&&o instanceof Number)return n.toString()===o.toString();if(!(n instanceof Object&&o instanceof Object))return!1;if(n.isPrototypeOf(o)||o.isPrototypeOf(n))return!1;if(n.constructor!==o.constructor)return!1;if(n.prototype!==o.prototype)return!1;if(e.indexOf(n)>-1||r.indexOf(o)>-1)return!1;for(a in o){if(o.hasOwnProperty(a)!==n.hasOwnProperty(a))return!1;if(typeof o[a]!=typeof n[a])return!1}for(a in n){if(o.hasOwnProperty(a)!==n.hasOwnProperty(a))return!1;if(typeof o[a]!=typeof n[a])return!1;switch(typeof n[a]){case"object":case"function":if(e.push(n),r.push(o),!t(n[a],o[a]))return!1;e.pop(),r.pop();break;default:if(n[a]!==o[a])return!1}}return!0}(t,n)})(t.val,e)||(t.old=t.val,t.val=e,t.changed=!0,t.trans.forEach(n=>{n.func()&&t.trans.delete(n)}),t.changed=!1),!0),o=t=>t.map(t=>(t=>0==t&&!(t=>!!t&&t.constructor&&"Array"==t.constructor.name)(t)||!!t)(t.val)).reduce((t,n)=>t&&n,!0),a=(t,n)=>{if(t.length>0){const e={nodes:t,func:n};return t.forEach(t=>{const n=t.target.trans;n.has(e)||n.add(e)}),o(t)&&n(),e}return null},f=(t,n)=>a(t,()=>{o(t)&&n()}),u=t=>{t.nodes.forEach(n=>{n.target.trans.delete(t)})},i=n=>n.isNode?n:t(n),c=(n,e,r)=>{const o=t(null,r);return a(n,()=>{o.val=e()}),o},s=(n,e,r)=>{const o=t(null,r);return f(n,()=>{o.val=e()}),o},l=(t,n,e)=>c(t,()=>n(...t.map(t=>t.val)),e),p=(t,n,e)=>s(t,()=>n(...t.map(t=>t.val)),e);export{l as mapN,t as node,c as nodeT,u as removeTran,p as safeMapN,s as safeNodeT,f as safeTran,i as toNode,a as tran};
